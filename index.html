<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Preguntas por Tema y Tipo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff7e6;
      color: #333;
      margin: 0; padding: 20px;
    }
    select, button {
      padding: 10px;
      font-size: 1rem;
      margin: 5px 0;
    }
    #preguntaContainer {
      margin-top: 20px;
      font-size: 1.2rem;
      font-weight: bold;
    }
    #opcionesContainer button {
      display: block;
      margin: 8px 0;
      width: 100%;
      text-align: left;
      border: none;
      background: #f0c987;
      cursor: pointer;
      border-radius: 6px;
      transition: background-color 0.3s ease;
    }
    #opcionesContainer button:hover:not(:disabled) {
      background-color: #f7d68e;
    }
    #opcionesContainer button:disabled {
      cursor: default;
    }
    .green {
      background-color: #4caf50 !important;
      color: white;
    }
    .red {
      background-color: #f44336 !important;
      color: white;
    }
    #respuestaContainer {
      margin-top: 15px;
      font-size: 1rem;
      padding: 12px;
      border-radius: 6px;
      background-color: #ffe9b3;
      display: none;
    }
    #respuestaContainer.visible {
      display: block;
    }
    #siguienteBtn, #mostrarRespuestaBtn, #reiniciarBtn {
      margin-top: 20px;
    }
    #mensajeFinal {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>

<h1>Preguntas por Tema y Tipo</h1>

<label for="tipoSelect">Selecciona Tipo:</label>
<select id="tipoSelect">
  <option value="">-- Selecciona tipo --</option>
  <option value="reflexion">Reflexión</option>
  <option value="quiz">Quiz</option>
  <option value="quiz_comentado">Quiz Comentado</option>
</select>

<label for="temaSelect">Selecciona Tema:</label>
<select id="temaSelect">
  <option value="">-- Selecciona tema --</option>
</select>

<button id="iniciarBtn">Iniciar</button>

<div id="preguntaContainer"></div>
<div id="opcionesContainer"></div>
<div id="respuestaContainer"></div>

<button id="mostrarRespuestaBtn" class="oculto">Mostrar Respuesta</button>
<button id="siguienteBtn" class="oculto">Siguiente</button>
<button id="reiniciarBtn" class="oculto">Reiniciar</button>

<div id="mensajeFinal"></div>

<script>
// Fragmento de datos de ejemplo
const datos = [
  {
    "tipo": "Quiz Comentado",
    "tema": "Noé",
    "pregunta": "¿Cuántos días duró el diluvio?",
    "respuesta": "40 días y 40 noches.",
    "opcion_1": "7 días",
    "opcion_2": "100 días",
    "opcion_3": "12 días",
    "correcta": 0,
    "cita biblica": "Génesis 7:12"
  },
  {
    "tipo": "reflexion",
    "tema": "Jonás",
    "pregunta": "¿Qué le pasó a Jonás cuando huyó de la misión?",
    "respuesta": "Fue tragado por un pez",
    "cita biblica": ""
  },
  {
    "tipo": "quiz",
    "tema": "Moisés",
    "pregunta": "¿Qué hizo Moisés para sacar agua de la roca?",
    "respuesta": "Golpeó la roca con su bastón",
    "opcion_1": "Rezó a Dios",
    "opcion_2": "Hizo un milagro con su capa",
    "opcion_3": "Llamó al viento",
    "correcta": 0,
    "cita biblica": ""
  }
];

const tipoSelect = document.getElementById('tipoSelect');
const temaSelect = document.getElementById('temaSelect');
const iniciarBtn = document.getElementById('iniciarBtn');
const preguntaContainer = document.getElementById('preguntaContainer');
const opcionesContainer = document.getElementById('opcionesContainer');
const respuestaContainer = document.getElementById('respuestaContainer');
const mostrarRespuestaBtn = document.getElementById('mostrarRespuestaBtn');
const siguienteBtn = document.getElementById('siguienteBtn');
const reiniciarBtn = document.getElementById('reiniciarBtn');
const mensajeFinal = document.getElementById('mensajeFinal');

let preguntasFiltradas = [];
let indiceActual = 0;
let puntaje = 0;

function normalizarTipo(tipo) {
  return tipo.toLowerCase().replace(/\s+/g, '_');
}

function actualizarTemasPorTipo() {
  temaSelect.innerHTML = '<option value="">-- Selecciona tema --</option>';
  const tipo = normalizarTipo(tipoSelect.value);
  const temas = [...new Set(datos.filter(d => normalizarTipo(d.tipo) === tipo).map(d => d.tema))];
  temas.forEach(t => {
    const option = document.createElement('option');
    option.value = t;
    option.textContent = t;
    temaSelect.appendChild(option);
  });
}

tipoSelect.addEventListener('change', actualizarTemasPorTipo);

function iniciar() {
  const tema = temaSelect.value;
  const tipo = normalizarTipo(tipoSelect.value);
  if (!tema || !tipo) {
    alert('Por favor, selecciona tema y tipo.');
    return;
  }

  preguntasFiltradas = datos.filter(d => d.tema === tema && normalizarTipo(d.tipo) === tipo);
  if (preguntasFiltradas.length === 0) {
    alert('No hay preguntas para esa combinación.');
    return;
  }

  indiceActual = 0;
  puntaje = 0;
  mensajeFinal.textContent = '';
  reiniciarBtn.classList.add('oculto');
  mostrarRespuestaBtn.classList.add('oculto');
  siguienteBtn.classList.add('oculto');
  respuestaContainer.classList.remove('visible');
  respuestaContainer.innerHTML = '';
  preguntaContainer.textContent = '';
  opcionesContainer.innerHTML = '';

  mostrarPregunta();
}

function mostrarPregunta() {
  const actual = preguntasFiltradas[indiceActual];
  const tipo = normalizarTipo(tipoSelect.value);

  preguntaContainer.textContent = actual.pregunta;
  opcionesContainer.innerHTML = '';
  respuestaContainer.classList.remove('visible');
  respuestaContainer.innerHTML = '';
  siguienteBtn.classList.add('oculto');
  mostrarRespuestaBtn.classList.add('oculto');

  if (tipo === 'reflexion') {
    mostrarRespuestaBtn.classList.remove('oculto');
  } else if (tipo === 'quiz' || tipo === 'quiz_comentado') {
    const opciones = [actual.opcion_1, actual.opcion_2, actual.opcion_3];
    opciones.forEach((op, i) => {
      const btn = document.createElement('button');
      btn.textContent = op;
      btn.onclick = () => {
        if (opcionesContainer.querySelector('button[disabled]')) return;

        if (i === actual.correcta) {
          btn.classList.add('green');
          puntaje++;
        } else {
          btn.classList.add('red');
          opcionesContainer.children[actual.correcta]?.classList.add('green');
        }

        Array.from(opcionesContainer.children).forEach(b => b.disabled = true);

        if (tipo === 'quiz_comentado') {
          respuestaContainer.innerHTML = `<strong>Respuesta correcta:</strong> ${actual.respuesta}<br><em>${actual["cita biblica"] || ''}</em>`;
          respuestaContainer.classList.add('visible');
        }

        siguienteBtn.classList.remove('oculto');
      };
      opcionesContainer.appendChild(btn);
    });
  }
}

iniciarBtn.addEventListener('click', iniciar);

siguienteBtn.addEventListener('click', () => {
  indiceActual++;
  if (indiceActual >= preguntasFiltradas.length) {
    mostrarResultados();
  } else {
    mostrarPregunta();
  }
});

mostrarRespuestaBtn.addEventListener('click', () => {
  if (preguntasFiltradas.length === 0) return;
  const actual = preguntasFiltradas[indiceActual];
  respuestaContainer.innerHTML = actual.respuesta || '';
  if (actual["cita biblica"]) {
    respuestaContainer.innerHTML += `<br><em>${actual["cita biblica"]}</em>`;
  }
  respuestaContainer.classList.add('visible');
  mostrarRespuestaBtn.classList.add('oculto');
});

reiniciarBtn.addEventListener('click', () => {
  indiceActual = 0;
  puntaje = 0;
  mensajeFinal.textContent = '';
  reiniciarBtn.classList.add('oculto');
  preguntaContainer.textContent = '';
  opcionesContainer.innerHTML = '';
  respuestaContainer.innerHTML = '';
  respuestaContainer.classList.remove('visible');
  mostrarRespuestaBtn.classList.add('oculto');
  siguienteBtn.classList.add('oculto');
});

function mostrarResultados() {
  preguntaContainer.textContent = '';
  opcionesContainer.innerHTML = '';
  respuestaContainer.innerHTML = '';
  respuestaContainer.classList.remove('visible');
  siguienteBtn.classList.add('oculto');
  mostrarRespuestaBtn.classList.add('oculto');

  const total = preguntasFiltradas.length;
  mensajeFinal.textContent = `Has respondido ${puntaje} de ${total} correctamente.`;

  reiniciarBtn.classList.remove('oculto');
}
</script>

</body>
</html>
