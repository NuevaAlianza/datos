<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Preguntas por Tema y Tipo - Quiz Comentado</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff7e6;
    color: #333;
    margin: 0; padding: 20px;
  }
  select, button {
    padding: 10px;
    font-size: 1rem;
    margin: 5px 0;
  }
  #preguntaContainer {
    margin-top: 20px;
    font-size: 1.2rem;
    font-weight: bold;
  }
  #opcionesContainer button {
    display: block;
    margin: 8px 0;
    width: 100%;
    text-align: left;
    border: none;
    background: #f0c987;
    cursor: pointer;
    border-radius: 6px;
    transition: background-color 0.3s ease;
  }
  #opcionesContainer button:hover:not(:disabled) {
    background-color: #f7d68e;
  }
  #opcionesContainer button:disabled {
    cursor: default;
  }
  .green {
    background-color: #4caf50 !important;
    color: white;
  }
  .red {
    background-color: #f44336 !important;
    color: white;
  }
  #respuestaContainer {
    margin-top: 15px;
    font-size: 1rem;
    padding: 12px;
    border-radius: 6px;
    background-color: #ffe9b3;
    display: none;
  }
  #respuestaContainer.visible {
    display: block;
  }
  #siguienteBtn, #mostrarRespuestaBtn, #reiniciarBtn {
    margin-top: 20px;
  }
  #mensajeFinal {
    margin-top: 20px;
    font-weight: bold;
    font-size: 1.2rem;
  }
  .oculto {
    display: none !important;
  }
</style>
</head>
<body>

<h1>Preguntas por Tema y Tipo</h1>

<label for="tipoSelect">Selecciona Tipo:</label>
<select id="tipoSelect">
  <option value="">-- Selecciona tipo --</option>
  <option value="reflexion">Reflexión</option>
  <option value="quiz">Quiz</option>
  <option value="quiz_comentado">Quiz Comentado</option>
</select>

<label for="temaSelect">Selecciona Tema:</label>
<select id="temaSelect">
  <option value="">-- Selecciona tema --</option>
</select>

<button id="iniciarBtn">Iniciar</button>

<div id="preguntaContainer"></div>
<div id="opcionesContainer"></div>

<div id="respuestaContainer"></div>

<button id="mostrarRespuestaBtn" class="oculto">Mostrar Respuesta</button>
<button id="siguienteBtn" class="oculto">Siguiente</button>
<button id="reiniciarBtn" class="oculto">Reiniciar</button>

<div id="mensajeFinal"></div>

<script>
const datos = [
  {
    tema: "Fe",
    tipo: "quiz_comentado",
    pregunta: "¿Qué significa tener fe?",
    opciones: ["Confiar en Dios", "Tener dinero", "Ser famoso"],
    respuesta: "Confiar en Dios",
    "cita biblica": "Hebreos 11:1"
  },
  {
    tema: "Fe",
    tipo: "quiz",
    pregunta: "¿Quién es el autor de la fe?",
    opciones: ["Dios", "Jesús", "El Espíritu Santo"],
    respuesta: "Dios",
    "cita biblica": "Hebreos 12:2"
  },
  {
    tema: "Amor",
    tipo: "reflexion",
    pregunta: "¿Cómo podemos mostrar el amor de Dios en la vida diaria?",
    respuesta: "Amando a nuestro prójimo como a nosotros mismos.",
    "cita biblica": "1 Juan 4:7"
  },
  {
    tema: "Esperanza",
    tipo: "quiz_comentado",
    pregunta: "¿Qué nos da esperanza en tiempos difíciles?",
    opciones: ["La fe en Dios", "La suerte", "El dinero"],
    respuesta: "La fe en Dios",
    "cita biblica": "Romanos 15:13"
  }
];

const temaSelect = document.getElementById('temaSelect');
const tipoSelect = document.getElementById('tipoSelect');
const iniciarBtn = document.getElementById('iniciarBtn');
const preguntaContainer = document.getElementById('preguntaContainer');
const opcionesContainer = document.getElementById('opcionesContainer');
const respuestaContainer = document.getElementById('respuestaContainer');
const mostrarRespuestaBtn = document.getElementById('mostrarRespuestaBtn');
const siguienteBtn = document.getElementById('siguienteBtn');
const reiniciarBtn = document.getElementById('reiniciarBtn');
const mensajeFinal = document.getElementById('mensajeFinal');

let preguntasFiltradas = [];
let indiceActual = 0;
let puntaje = 0;

function actualizarTemasPorTipo() {
  const tipo = tipoSelect.value;
  let temasFiltrados;
  if (!tipo) {
    temasFiltrados = [...new Set(datos.map(d => d.tema))];
  } else {
    temasFiltrados = [...new Set(datos.filter(d => d.tipo === tipo).map(d => d.tema))];
  }
  temaSelect.innerHTML = '<option value="">-- Selecciona tema --</option>';
  temasFiltrados.forEach(t => {
    const option = document.createElement('option');
    option.value = t;
    option.textContent = t;
    temaSelect.appendChild(option);
  });
}

tipoSelect.addEventListener('change', () => {
  actualizarTemasPorTipo();
  temaSelect.value = '';
});

function iniciar() {
  const tema = temaSelect.value;
  const tipo = tipoSelect.value;
  if (!tema || !tipo) {
    alert('Por favor, selecciona tema y tipo.');
    return;
  }

  preguntasFiltradas = datos.filter(d => d.tema === tema && d.tipo === tipo);
  if (preguntasFiltradas.length === 0) {
    alert('No hay preguntas para esa combinación.');
    return;
  }

  indiceActual = 0;
  puntaje = 0;
  mensajeFinal.textContent = '';
  reiniciarBtn.classList.add('oculto');
  mostrarRespuestaBtn.classList.add('oculto');
  siguienteBtn.classList.add('oculto');
  respuestaContainer.classList.remove('visible');
  respuestaContainer.innerHTML = '';
  preguntaContainer.textContent = '';
  opcionesContainer.innerHTML = '';

  mostrarPregunta();
}

function mostrarPregunta() {
  respuestaContainer.classList.remove('visible');
  respuestaContainer.innerHTML = '';
  siguienteBtn.classList.add('oculto');
  mostrarRespuestaBtn.classList.add('oculto');
  opcionesContainer.innerHTML = '';

  const actual = preguntasFiltradas[indiceActual];
  preguntaContainer.textContent = actual.pregunta;

  const tipo = tipoSelect.value;

  if (tipo === 'reflexion') {
    // Solo mostrar la pregunta
    mostrarRespuestaBtn.classList.remove('oculto');
  } else if (tipo === 'quiz' || tipo === 'quiz_comentado') {
    actual.opciones.forEach(op => {
      const btn = document.createElement('button');
      btn.textContent = op;
      btn.onclick = () => {
        if (opcionesContainer.querySelector('button[disabled]')) return;

        if (op === actual.respuesta) {
          btn.classList.add('green');
          puntaje++;
        } else {
          btn.classList.add('red');
          Array.from(opcionesContainer.children).forEach(b => {
            if (b.textContent === actual.respuesta) {
              b.classList.add('green');
            }
          });
        }

        if (tipo === 'quiz_comentado') {
          respuestaContainer.innerHTML = `<strong>Respuesta correcta:</strong> ${actual.respuesta}<br><em>${actual["cita biblica"] || ''}</em>`;
          respuestaContainer.classList.add('visible');
        }

        Array.from(opcionesContainer.children).forEach(b => b.disabled = true);

        siguienteBtn.classList.remove('oculto');
        mostrarRespuestaBtn.classList.toggle('oculto', tipo === 'quiz_comentado');
      };
      opcionesContainer.appendChild(btn);
    });
  }
}

iniciarBtn.addEventListener('click', () => {
  iniciar();
});

siguienteBtn.addEventListener('click', () => {
  indiceActual++;
  respuestaContainer.classList.remove('visible');
  respuestaContainer.innerHTML = '';
  if (indiceActual >= preguntasFiltradas.length) {
    mostrarResultados();
  } else {
    mostrarPregunta();
  }
});

mostrarRespuestaBtn.addEventListener('click', () => {
  if (preguntasFiltradas.length === 0) return;
  const actual = preguntasFiltradas[indiceActual];
  respuestaContainer.innerHTML = actual.respuesta || '';
  if (actual["cita biblica"]) {
    respuestaContainer.innerHTML += `<br><em>${actual["cita biblica"]}</em>`;
  }
  respuestaContainer.classList.add('visible');
  mostrarRespuestaBtn.classList.add('oculto');
});

reiniciarBtn.addEventListener('click', () => {
  indiceActual = 0;
  puntaje = 0;
  mensajeFinal.textContent = '';
  reiniciarBtn.classList.add('oculto');
  preguntaContainer.textContent = '';
  opcionesContainer.innerHTML = '';
  respuestaContainer.innerHTML = '';
  respuestaContainer.classList.remove('visible');
  mostrarRespuestaBtn.classList.add('oculto');
  siguienteBtn.classList.add('oculto');
  tipoSelect.value = '';
  actualizarTemasPorTipo();
  temaSelect.value = '';
});

function mostrarResultados() {
  preguntaContainer.textContent = '';
  opcionesContainer.innerHTML = '';
  respuestaContainer.innerHTML = '';
  respuestaContainer.classList.remove('visible');
  siguienteBtn.classList.add('oculto');
  mostrarRespuestaBtn.classList.add('oculto');

  const total = preguntasFiltradas.length;
  mensajeFinal.textContent = `Has respondido ${puntaje} de ${total} correctamente.`;

  reiniciarBtn.classList.remove('oculto');
}

// Al cargar, inicializar temas con todos los temas disponibles
actualizarTemasPorTipo();

</script>

</body>
</html>
